
//Exactly what i need is


CoInitializeEx(NULL, COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE);
	STARTUPINFO si = { sizeof(si) };
   SECURITY_ATTRIBUTES saProcess,saThread;
   PROCESS_INFORMATION piProcessB;

   TCHAR szPath[MAX_PATH];
   
   saProcess.nLength = sizeof(saProcess);
   saProcess.lpSecurityDescriptor = NULL;
   saProcess.bInheritHandle = TRUE;

	saThread.nLength = sizeof(saThread);
   saThread.lpSecurityDescriptor = NULL;
   saThread.bInheritHandle = FALSE;


	lstrcpy(szPath, TEXT("ADQuery.exe"));
	CTestHtmlDlgDlg::CloseWindow();
   CreateProcess(NULL, szPath, &saProcess, &saThread,
      FALSE, 0, NULL, NULL, &si, &piProcessB);
	WaitForSingleObject(piProcessB.hProcess,INFINITE);
	CTestHtmlDlgDlg::ShowWindow(1);

































CTestHtmlDlgDlg::CloseWindow();
	CoInitializeEx(NULL, COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE);
	STARTUPINFO si;
	PROCESS_INFORMATION pi;
	ZeroMemory(&si,sizeof(si));
	si.cb=sizeof(si);
	CString path=GetAppPath(); //path=path.Append("\\ADQuery.exe");
	CreateProcess(NULL,L"ADQuery.exe",NULL,NULL,true,0,NULL,NULL,&si,&pi);
	*if(!CreateProcess(NULL,L"ADQuery.exe",NULL,NULL,true,CREATE_NEW_CONSOLE,NULL,NULL,&si,&pi))
	{
		MessageBox(L"Problem in Creating Process");
		CTestHtmlDlgDlg::ShowWindow(1);
	}
	else
	{
		CTestHtmlDlgDlg::CloseWindow();
		WaitForSingleObject(pi.hProcess,INFINITE);
		CTestHtmlDlgDlg::ShowWindow(1);

	}
	
	system("ADQuery.exe");
	
	
    MessageBox(L"Command done!");
	*HINSTANCE hInst;
	hInst=ShellExecute(GetSafeHwnd(), L"open", L"ADQuery.exe", NULL, NULL, SW_SHOWNORMAL);
	if(reinterpret_cast<int>(hInst) == SE_ERR_ACCESSDENIED)
	{
		MessageBox(L"Before using this tool ensure \"Microsoft Visual C++ 2005 Redistributable\" package exists in your system.It can be downloaded from the link \n http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=32bc1bee-a3f9-4c13-9c99-220b62a191ee", L"AD Tools Information ",MB_OK | MB_ICONINFORMATION);
	}